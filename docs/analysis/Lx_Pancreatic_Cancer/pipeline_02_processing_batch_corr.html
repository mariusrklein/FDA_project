
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Lx_Pancreatic_Cancer: Processing &#8212; Ion suppression correction  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Ion suppression correction  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lx_Pancreatic_Cancer: Processing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Lx_Pancreatic_Cancer:-Processing">
<h1>Lx_Pancreatic_Cancer: Processing<a class="headerlink" href="#Lx_Pancreatic_Cancer:-Processing" title="Permalink to this heading">¶</a></h1>
<p>Datasets typically consist of several wells on a microscopy slide. In this notebook, the wells are integrated to one annotated data matrix.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">anndata</span> <span class="k">as</span> <span class="nn">ad</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/mklein/spacem&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/Volumes/mklein/spacem&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/mklein/FDA_project&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">src.correction</span> <span class="kn">import</span> <span class="n">get_matrices_from_dfs</span><span class="p">,</span> <span class="n">normalize_proportion_ratios</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">src.evaluation</span> <span class="kn">import</span> <span class="n">plot_all_ion_slopes</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_formats = [&#39;retina&#39;]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
    <span class="n">target_path</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/mklein/FDA_project/data/Lx_Glioblastoma&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">target_path</span> <span class="o">=</span> <span class="s1">&#39;/home/mklein/FDA_project/data/Lx_Glioblastoma&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">source_path</span> <span class="o">=</span> <span class="s2">&quot;/home/mklein/FDA_project/data/Lx_Pancreatic_Cancer&quot;</span>
<span class="n">target_path</span> <span class="o">=</span> <span class="s2">&quot;/home/mklein/FDA_project/data/Lx_Pancreatic_Cancer_batch_corr&quot;</span>
<span class="n">condition_name</span> <span class="o">=</span> <span class="s2">&quot;condition&quot;</span>
<span class="n">well_name</span> <span class="o">=</span> <span class="s2">&quot;slide_well&quot;</span>
<span class="n">analysis_path</span> <span class="o">=</span> <span class="s2">&quot;/home/mklein/FDA_project/analysis/Lx_Pancreatic_Cancer&quot;</span>
<span class="n">notebooks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;pipeline_01_correction.ipynb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pipeline_02_processing.ipynb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pipeline_03_evaluation.ipynb&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">project</span> <span class="o">=</span> <span class="s2">&quot;Lx_Pancreatic_Cancer&quot;</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dir</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">dir</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;.&quot;</span><span class="p">]</span>

<span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;am_sm_matrix&#39;</span><span class="p">:</span> <span class="s1">&#39;am_spatiomolecular_adata.h5ad&#39;</span><span class="p">,</span>
        <span class="s1">&#39;corr_am_sm_matrix&#39;</span><span class="p">:</span> <span class="s1">&#39;am_spatiomolecular_adata_corrected.h5ad&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cell_sm_matrix&#39;</span><span class="p">:</span> <span class="s1">&#39;cells_spatiomolecular_adata_spacem.h5ad&#39;</span><span class="p">,</span>
        <span class="s1">&#39;gen_cell_sm_matrix&#39;</span><span class="p">:</span> <span class="s1">&#39;cells_spatiomolecular_adata.h5ad&#39;</span><span class="p">,</span>
        <span class="s1">&#39;corr_cell_sm_matrix&#39;</span><span class="p">:</span> <span class="s1">&#39;cells_spatiomolecular_adata_corrected.h5ad&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<br/></pre></div>
</div>
</div>
<p>After loading all individual wells, they are concatenated into one data matrix. Cell identifiers are kept unique by adding a well-specific suffix</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">am_adata_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">am_adata_cor_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">adata_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">gen_adata_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">adata_cor_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
    <span class="n">sample_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>

    <span class="n">project_files</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sample_path</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># am_adata_dict[sample] = sc.read(project_files[&#39;am_sm_matrix&#39;])</span>
    <span class="c1"># am_adata_cor_dict[sample] = sc.read(project_files[&#39;corr_am_sm_matrix&#39;])</span>
    <span class="n">adata_dict</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">project_files</span><span class="p">[</span><span class="s1">&#39;cell_sm_matrix&#39;</span><span class="p">])</span>
    <span class="n">gen_adata_dict</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">project_files</span><span class="p">[</span><span class="s1">&#39;gen_cell_sm_matrix&#39;</span><span class="p">])</span>
    <span class="n">adata_cor_dict</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">project_files</span><span class="p">[</span><span class="s1">&#39;corr_cell_sm_matrix&#39;</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 12/12 [00:07&lt;00:00,  1.60it/s]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_dataset_info</span><span class="p">(</span><span class="n">adata</span><span class="p">):</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[[</span><span class="s1">&#39;dataset_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">split</span><span class="o">.</span><span class="n">columns</span><span class="p">]]</span> <span class="o">=</span> <span class="n">split</span>
</pre></div>
</div>
</div>
<p>The combination of wells is not restricted to concatenation of the corresponding data matrices. Some of the ion-related metadata, like the slopes used in ISM correction, are specific to the individual wells. Thus, they are summarised and mean values saved in the combined data matrices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_range_slopes</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">):</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="n">index_unique</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">conca_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">var</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">adata_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span>

    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">conca_var_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ion&#39;</span><span class="p">],</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">),</span>
              <span class="n">conca_var_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ion&#39;</span><span class="p">],</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">),</span>
              <span class="n">conca_var_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ion&#39;</span><span class="p">],</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)]</span>

    <span class="n">sum_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ion&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">]),</span> <span class="n">dfs</span><span class="p">),</span>
                      <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">var</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">adata_cor_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()})[[</span><span class="s1">&#39;correction_using_ion_pool&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                      <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ion&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">my_bin</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;4_all by pool&#39;</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;0_none by pool&#39;</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span><span class="mf">0.9</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;3_&gt;90% by pool&#39;</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;2_&gt;50% by pool&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;1_&lt;50% by pool&#39;</span>

    <span class="n">sum_df</span><span class="p">[</span><span class="s1">&#39;corr_pool_bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_bin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sum_df</span><span class="p">[</span><span class="s1">&#39;correction_using_ion_pool&#39;</span><span class="p">]]</span>
    <span class="c1">#pd.cut(sum_df[&#39;correction_using_ion_pool&#39;], bins=4)#, q=[0, .2, .4, .6, .8, 1], labels=[&#39;&lt;20%&#39;, &#39;&lt;40%&#39;, &#39;&lt;60%&#39;, &#39;&lt;80%&#39;, &#39;&gt;80%&#39;])</span>

    <span class="n">sum_df</span> <span class="o">=</span> <span class="n">sum_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;correction_using_ion_pool&#39;</span><span class="p">])</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">sum_df</span><span class="p">[</span><span class="n">sum_df</span><span class="o">.</span><span class="n">variable</span> <span class="o">==</span> <span class="s1">&#39;correction_quantreg_slope&#39;</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;ion&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;corr_pool_bins&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">sum_df</span><span class="p">[</span><span class="n">sum_df</span><span class="o">.</span><span class="n">variable</span> <span class="o">==</span> <span class="s1">&#39;correction_quantreg_slope&#39;</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;ion&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;corr_pool_bins&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">sum_df</span><span class="p">[</span><span class="n">sum_df</span><span class="o">.</span><span class="n">variable</span> <span class="o">==</span> <span class="s1">&#39;correction_quantreg_slope&#39;</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;ion&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;corr_pool_bins&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mean, max and min slope&#39;</span><span class="p">)</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;correction_using_ion_pool&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Range of ISM correction slopes across wells&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="k">def</span> <span class="nf">concat_wells</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">):</span>
    <span class="n">adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="n">index_unique</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">conca_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">var</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">adata_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;correction_quantreg_slope&#39;</span> <span class="ow">in</span> <span class="n">conca_var_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

        <span class="n">mean_var_df</span> <span class="o">=</span> <span class="n">conca_var_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean_&#39;</span><span class="o">+</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mean_var_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">std_var_df</span> <span class="o">=</span> <span class="n">conca_var_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">std_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sd_&#39;</span><span class="o">+</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">std_var_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">count_var_df</span> <span class="o">=</span> <span class="n">conca_var_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">count_var_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sum_&#39;</span><span class="o">+</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">count_var_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">,</span>
            <span class="n">mean_var_df</span><span class="p">[[</span><span class="s1">&#39;mean_correction_full_pixel_avg_intensities&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_correction_quantreg_slope&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_correction_quantreg_intersect&#39;</span><span class="p">]],</span>
            <span class="n">std_var_df</span><span class="p">[[</span><span class="s1">&#39;sd_correction_full_pixel_avg_intensities&#39;</span><span class="p">,</span> <span class="s1">&#39;sd_correction_quantreg_slope&#39;</span><span class="p">,</span> <span class="s1">&#39;sd_correction_quantreg_intersect&#39;</span><span class="p">]],</span>
            <span class="n">count_var_df</span><span class="p">[[</span><span class="s1">&#39;sum_correction_using_ion_pool&#39;</span><span class="p">]]</span> <span class="p">]</span>

        <span class="n">adata</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">dfs</span><span class="p">)</span>
        <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;corrected_only_using_pool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;sum_correction_using_ion_pool&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">)</span>

    <span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">external</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">bbknn</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">batch_key</span><span class="o">=</span><span class="s1">&#39;well&#39;</span><span class="p">)</span>
    <span class="n">split_dataset_info</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adata</span>

<span class="c1"># am_adata = concat_wells(am_adata_dict)</span>
<span class="c1"># am_adata_cor = concat_wells(am_adata_cor_dict)</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">concat_wells</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">)</span>
<span class="n">gen_adata</span> <span class="o">=</span> <span class="n">concat_wells</span><span class="p">(</span><span class="n">gen_adata_dict</span><span class="p">)</span>
<span class="n">adata_cor</span> <span class="o">=</span> <span class="n">concat_wells</span><span class="p">(</span><span class="n">adata_cor_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[10], line 33</span>
<span class="ansi-green-intense-fg ansi-bold">     30</span> <span style="color: rgb(95,135,135)"># am_adata = concat_wells(am_adata_dict)</span>
<span class="ansi-green-intense-fg ansi-bold">     31</span> <span style="color: rgb(95,135,135)"># am_adata_cor = concat_wells(am_adata_cor_dict)</span>
<span class="ansi-green-intense-fg ansi-bold">     32</span> adata <span style="color: rgb(98,98,98)">=</span> concat_wells(adata_dict)
<span class="ansi-green-fg">---&gt; 33</span> gen_adata <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">concat_wells</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">gen_adata_dict</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span> adata_cor <span style="color: rgb(98,98,98)">=</span> concat_wells(adata_cor_dict)

Cell <span class="ansi-green-fg">In[10], line 25</span>, in <span class="ansi-cyan-fg">concat_wells</span><span class="ansi-blue-fg">(adata_dict)</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>     adata<span style="color: rgb(98,98,98)">.</span>var <span style="color: rgb(98,98,98)">=</span> functools<span style="color: rgb(98,98,98)">.</span>reduce(<span class="ansi-bold" style="color: rgb(0,135,0)">lambda</span> left,right: pd<span style="color: rgb(98,98,98)">.</span>merge(left, right, how<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">left</span><span style="color: rgb(175,0,0)">&#39;</span>, left_index<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>, right_index<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>), dfs)
<span class="ansi-green-intense-fg ansi-bold">     23</span>     adata<span style="color: rgb(98,98,98)">.</span>var[<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">corrected_only_using_pool</span><span style="color: rgb(175,0,0)">&#39;</span>] <span style="color: rgb(98,98,98)">=</span> adata<span style="color: rgb(98,98,98)">.</span>var[<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">sum_correction_using_ion_pool</span><span style="color: rgb(175,0,0)">&#39;</span>] <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(0,135,0)">len</span>(adata_dict)
<span class="ansi-green-fg">---&gt; 25</span> <span class="ansi-yellow-bg">sc</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">tl</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">pca</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">adata</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     26</span> sc<span style="color: rgb(98,98,98)">.</span>external<span style="color: rgb(98,98,98)">.</span>pp<span style="color: rgb(98,98,98)">.</span>bbknn(adata, batch_key<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">well</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-intense-fg ansi-bold">     27</span> split_dataset_info(adata)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scanpy/preprocessing/_pca.py:188</span>, in <span class="ansi-cyan-fg">pca</span><span class="ansi-blue-fg">(data, n_comps, zero_center, svd_solver, random_state, return_info, use_highly_variable, dtype, copy, chunked, chunk_size)</span>
<span class="ansi-green-intense-fg ansi-bold">    184</span>         X <span style="color: rgb(98,98,98)">=</span> X<span style="color: rgb(98,98,98)">.</span>toarray()
<span class="ansi-green-intense-fg ansi-bold">    185</span>     pca_ <span style="color: rgb(98,98,98)">=</span> PCA(
<span class="ansi-green-intense-fg ansi-bold">    186</span>         n_components<span style="color: rgb(98,98,98)">=</span>n_comps, svd_solver<span style="color: rgb(98,98,98)">=</span>svd_solver, random_state<span style="color: rgb(98,98,98)">=</span>random_state
<span class="ansi-green-intense-fg ansi-bold">    187</span>     )
<span class="ansi-green-fg">--&gt; 188</span>     X_pca <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">pca_</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    189</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> issparse(X) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> zero_center:
<span class="ansi-green-intense-fg ansi-bold">    190</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">sklearn</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">decomposition</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> PCA

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/sklearn/utils/_set_output.py:142</span>, in <span class="ansi-cyan-fg">_wrap_method_output.&lt;locals&gt;.wrapped</span><span class="ansi-blue-fg">(self, X, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    140</span> <span style="color: rgb(175,0,255)">@wraps</span>(f)
<span class="ansi-green-intense-fg ansi-bold">    141</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">wrapped</span>(<span style="color: rgb(0,135,0)">self</span>, X, <span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-fg">--&gt; 142</span>     data_to_wrap <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">f</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    143</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">isinstance</span>(data_to_wrap, <span style="color: rgb(0,135,0)">tuple</span>):
<span class="ansi-green-intense-fg ansi-bold">    144</span>         <span style="color: rgb(95,135,135)"># only wrap the first output for cross decomposition</span>
<span class="ansi-green-intense-fg ansi-bold">    145</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> (
<span class="ansi-green-intense-fg ansi-bold">    146</span>             _wrap_data_with_container(method, data_to_wrap[<span style="color: rgb(98,98,98)">0</span>], X, <span style="color: rgb(0,135,0)">self</span>),
<span class="ansi-green-intense-fg ansi-bold">    147</span>             <span style="color: rgb(98,98,98)">*</span>data_to_wrap[<span style="color: rgb(98,98,98)">1</span>:],
<span class="ansi-green-intense-fg ansi-bold">    148</span>         )

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/sklearn/decomposition/_pca.py:462</span>, in <span class="ansi-cyan-fg">PCA.fit_transform</span><span class="ansi-blue-fg">(self, X, y)</span>
<span class="ansi-green-intense-fg ansi-bold">    439</span> <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Fit the model with X and apply the dimensionality reduction on X.</span>
<span class="ansi-green-intense-fg ansi-bold">    440</span>
<span class="ansi-green-intense-fg ansi-bold">    441</span> <span style="color: rgb(175,0,0)">Parameters</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    458</span> <span style="color: rgb(175,0,0)">C-ordered array, use &#39;np.ascontiguousarray&#39;.</span>
<span class="ansi-green-intense-fg ansi-bold">    459</span> <span style="color: rgb(175,0,0)">&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    460</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_validate_params()
<span class="ansi-green-fg">--&gt; 462</span> U, S, Vt <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    463</span> U <span style="color: rgb(98,98,98)">=</span> U[:, : <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>n_components_]
<span class="ansi-green-intense-fg ansi-bold">    465</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>whiten:
<span class="ansi-green-intense-fg ansi-bold">    466</span>     <span style="color: rgb(95,135,135)"># X_new = X * V / S * sqrt(n_samples) = U * sqrt(n_samples)</span>

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/sklearn/decomposition/_pca.py:514</span>, in <span class="ansi-cyan-fg">PCA._fit</span><span class="ansi-blue-fg">(self, X)</span>
<span class="ansi-green-intense-fg ansi-bold">    512</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_fit_full(X, n_components)
<span class="ansi-green-intense-fg ansi-bold">    513</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_fit_svd_solver <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> [<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">arpack</span><span style="color: rgb(175,0,0)">&#34;</span>, <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">randomized</span><span style="color: rgb(175,0,0)">&#34;</span>]:
<span class="ansi-green-fg">--&gt; 514</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_fit_truncated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">n_components</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_fit_svd_solver</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/sklearn/decomposition/_pca.py:609</span>, in <span class="ansi-cyan-fg">PCA._fit_truncated</span><span class="ansi-blue-fg">(self, X, n_components, svd_solver)</span>
<span class="ansi-green-intense-fg ansi-bold">    607</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> svd_solver <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">arpack</span><span style="color: rgb(175,0,0)">&#34;</span>:
<span class="ansi-green-intense-fg ansi-bold">    608</span>     v0 <span style="color: rgb(98,98,98)">=</span> _init_arpack_v0(<span style="color: rgb(0,135,0)">min</span>(X<span style="color: rgb(98,98,98)">.</span>shape), random_state)
<span class="ansi-green-fg">--&gt; 609</span>     U, S, Vt <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">svds</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">n_components</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">tol</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">tol</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v0</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">v0</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    610</span>     <span style="color: rgb(95,135,135)"># svds doesn&#39;t abide by scipy.linalg.svd/randomized_svd</span>
<span class="ansi-green-intense-fg ansi-bold">    611</span>     <span style="color: rgb(95,135,135)"># conventions, so reverse its outputs.</span>
<span class="ansi-green-intense-fg ansi-bold">    612</span>     S <span style="color: rgb(98,98,98)">=</span> S[::<span style="color: rgb(98,98,98)">-</span><span style="color: rgb(98,98,98)">1</span>]

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_eigen/_svds.py:532</span>, in <span class="ansi-cyan-fg">svds</span><span class="ansi-blue-fg">(A, k, ncv, tol, which, v0, maxiter, return_singular_vectors, solver, random_state, options)</span>
<span class="ansi-green-intense-fg ansi-bold">    530</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> v0 <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-intense-fg ansi-bold">    531</span>     v0 <span style="color: rgb(98,98,98)">=</span> random_state<span style="color: rgb(98,98,98)">.</span>standard_normal(size<span style="color: rgb(98,98,98)">=</span>(<span style="color: rgb(0,135,0)">min</span>(A<span style="color: rgb(98,98,98)">.</span>shape),))
<span class="ansi-green-fg">--&gt; 532</span> _, eigvec <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">eigsh</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">XH_X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">tol</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">tol</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">2</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">maxiter</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">maxiter</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    533</span> <span class="ansi-yellow-bg">                  </span><span class="ansi-yellow-bg">ncv</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">ncv</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">which</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">which</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v0</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">v0</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    534</span> <span style="color: rgb(95,135,135)"># arpack do not guarantee exactly orthonormal eigenvectors</span>
<span class="ansi-green-intense-fg ansi-bold">    535</span> <span style="color: rgb(95,135,135)"># for clustered eigenvalues, especially in complex arithmetic</span>
<span class="ansi-green-intense-fg ansi-bold">    536</span> eigvec, _ <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>linalg<span style="color: rgb(98,98,98)">.</span>qr(eigvec)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_eigen/arpack/arpack.py:1697</span>, in <span class="ansi-cyan-fg">eigsh</span><span class="ansi-blue-fg">(A, k, M, sigma, which, v0, ncv, maxiter, tol, return_eigenvectors, Minv, OPinv, mode)</span>
<span class="ansi-green-intense-fg ansi-bold">   1695</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> _ARPACK_LOCK:
<span class="ansi-green-intense-fg ansi-bold">   1696</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">while</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> params<span style="color: rgb(98,98,98)">.</span>converged:
<span class="ansi-green-fg">-&gt; 1697</span>         <span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">iterate</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1699</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> params<span style="color: rgb(98,98,98)">.</span>extract(return_eigenvectors)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_eigen/arpack/arpack.py:549</span>, in <span class="ansi-cyan-fg">_SymmetricArpackParams.iterate</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    546</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>ido <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">1</span>:
<span class="ansi-green-intense-fg ansi-bold">    547</span>     <span style="color: rgb(95,135,135)"># compute y = Op*x</span>
<span class="ansi-green-intense-fg ansi-bold">    548</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>mode <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">1</span>:
<span class="ansi-green-fg">--&gt; 549</span>         <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>workd[yslice] <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">OP</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">workd</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">xslice</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    550</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>mode <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">2</span>:
<span class="ansi-green-intense-fg ansi-bold">    551</span>         <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>workd[xslice] <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>OPb(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>workd[xslice])

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_interface.py:232</span>, in <span class="ansi-cyan-fg">LinearOperator.matvec</span><span class="ansi-blue-fg">(self, x)</span>
<span class="ansi-green-intense-fg ansi-bold">    229</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> x<span style="color: rgb(98,98,98)">.</span>shape <span style="color: rgb(98,98,98)">!=</span> (N,) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> x<span style="color: rgb(98,98,98)">.</span>shape <span style="color: rgb(98,98,98)">!=</span> (N,<span style="color: rgb(98,98,98)">1</span>):
<span class="ansi-green-intense-fg ansi-bold">    230</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">dimension mismatch</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">--&gt; 232</span> y <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_matvec</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">x</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    234</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">isinstance</span>(x, np<span style="color: rgb(98,98,98)">.</span>matrix):
<span class="ansi-green-intense-fg ansi-bold">    235</span>     y <span style="color: rgb(98,98,98)">=</span> asmatrix(y)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_interface.py:530</span>, in <span class="ansi-cyan-fg">_CustomLinearOperator._matvec</span><span class="ansi-blue-fg">(self, x)</span>
<span class="ansi-green-intense-fg ansi-bold">    529</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">_matvec</span>(<span style="color: rgb(0,135,0)">self</span>, x):
<span class="ansi-green-fg">--&gt; 530</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">__matvec_impl</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">x</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_eigen/_svds.py:473</span>, in <span class="ansi-cyan-fg">svds.&lt;locals&gt;.matvec_XH_X</span><span class="ansi-blue-fg">(x)</span>
<span class="ansi-green-intense-fg ansi-bold">    472</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">matvec_XH_X</span>(x):
<span class="ansi-green-fg">--&gt; 473</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> XH_dot(<span class="ansi-yellow-bg">X_dot</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">x</span><span class="ansi-yellow-bg">)</span>)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_interface.py:232</span>, in <span class="ansi-cyan-fg">LinearOperator.matvec</span><span class="ansi-blue-fg">(self, x)</span>
<span class="ansi-green-intense-fg ansi-bold">    229</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> x<span style="color: rgb(98,98,98)">.</span>shape <span style="color: rgb(98,98,98)">!=</span> (N,) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> x<span style="color: rgb(98,98,98)">.</span>shape <span style="color: rgb(98,98,98)">!=</span> (N,<span style="color: rgb(98,98,98)">1</span>):
<span class="ansi-green-intense-fg ansi-bold">    230</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">dimension mismatch</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">--&gt; 232</span> y <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_matvec</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">x</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    234</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">isinstance</span>(x, np<span style="color: rgb(98,98,98)">.</span>matrix):
<span class="ansi-green-intense-fg ansi-bold">    235</span>     y <span style="color: rgb(98,98,98)">=</span> asmatrix(y)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_interface.py:199</span>, in <span class="ansi-cyan-fg">LinearOperator._matvec</span><span class="ansi-blue-fg">(self, x)</span>
<span class="ansi-green-intense-fg ansi-bold">    189</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">_matvec</span>(<span style="color: rgb(0,135,0)">self</span>, x):
<span class="ansi-green-intense-fg ansi-bold">    190</span> <span style="color: rgb(188,188,188)">    </span><span style="color: rgb(175,0,0)">&#34;&#34;&#34;Default matrix-vector multiplication handler.</span>
<span class="ansi-green-intense-fg ansi-bold">    191</span>
<span class="ansi-green-intense-fg ansi-bold">    192</span> <span style="color: rgb(175,0,0)">    If self is a linear operator of shape (M, N), then this method will</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    197</span> <span style="color: rgb(175,0,0)">    will define matrix-vector multiplication as well.</span>
<span class="ansi-green-intense-fg ansi-bold">    198</span> <span style="color: rgb(175,0,0)">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 199</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">matmat</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">x</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">reshape</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">-</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_interface.py:337</span>, in <span class="ansi-cyan-fg">LinearOperator.matmat</span><span class="ansi-blue-fg">(self, X)</span>
<span class="ansi-green-intense-fg ansi-bold">    333</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> X<span style="color: rgb(98,98,98)">.</span>shape[<span style="color: rgb(98,98,98)">0</span>] <span style="color: rgb(98,98,98)">!=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>shape[<span style="color: rgb(98,98,98)">1</span>]:
<span class="ansi-green-intense-fg ansi-bold">    334</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">dimension mismatch: </span><span class="ansi-bold" style="color: rgb(175,95,135)">%r</span><span style="color: rgb(175,0,0)">, </span><span class="ansi-bold" style="color: rgb(175,95,135)">%r</span><span style="color: rgb(175,0,0)">&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">    335</span>                      <span style="color: rgb(98,98,98)">%</span> (<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>shape, X<span style="color: rgb(98,98,98)">.</span>shape))
<span class="ansi-green-fg">--&gt; 337</span> Y <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_matmat</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">isinstance</span>(Y, np<span style="color: rgb(98,98,98)">.</span>matrix):
<span class="ansi-green-intense-fg ansi-bold">    340</span>     Y <span style="color: rgb(98,98,98)">=</span> asmatrix(Y)

File <span class="ansi-green-fg">~/miniconda3/envs/ion_suppression/lib/python3.10/site-packages/scipy/sparse/linalg/_interface.py:733</span>, in <span class="ansi-cyan-fg">MatrixLinearOperator._matmat</span><span class="ansi-blue-fg">(self, X)</span>
<span class="ansi-green-intense-fg ansi-bold">    732</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">_matmat</span>(<span style="color: rgb(0,135,0)">self</span>, X):
<span class="ansi-green-fg">--&gt; 733</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">A</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">dot</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div></div>
</div>
<p>Especially for the underlying slopes of the ISM correction, taking the mean removes a lot of information. In reality, the different wells exhibit a large variety of slopes, which is visualized in the following figure. All ions are shown by increasing fraction of pool-corrected wells. Clearly, the lower this fraction, the more variable the distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_range_slopes</span><span class="p">(</span><span class="n">adata_cor_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/analysis_Lx_Pancreatic_Cancer_pipeline_02_processing_batch_corr_12_0.png" class="no-scaled-link" src="../../_images/analysis_Lx_Pancreatic_Cancer_pipeline_02_processing_batch_corr_12_0.png" style="width: 1589px; height: 391px;" />
</div>
</div>
<p>The concatenated annotated data matrices are individually saved to file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="s2">&quot;batch_sm_matrix.h5ad&quot;</span><span class="p">))</span>
<span class="n">gen_adata</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="s2">&quot;gen_batch_sm_matrix.h5ad&quot;</span><span class="p">))</span>
<span class="n">adata_cor</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_path</span><span class="p">,</span> <span class="s2">&quot;corrected_batch_sm_matrix.h5ad&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>In order to ensure that especially the pixel-cell deconvolution was successful across samples, the summed absolute deviations between different annotated datasets are visualized in the following plot. On one hand, the uncorected but manually deconvoluted (generated) dataset is compared to the dataset directly output by SpaceM. If the same parameters were used for deconvolution, these dataset should not exhibit any differences. On the other hand, the corrected dataset is compared to the generated
dataset. These dataset should exhibit differences on a comparable level across samples. If one of the samples shows much greater differences than the others, there might be a sample-specific problem with the parameters used for deconvolution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_deviations</span><span class="p">(</span><span class="n">adata1</span><span class="p">,</span> <span class="n">adata2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">adata1</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span> <span class="o">-</span> <span class="n">adata2</span><span class="o">.</span><span class="n">to_df</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># df = df / (adata1.to_df().shape[0] * adata1.to_df().shape[1])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">adata1</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="s1">&#39;summed deviation&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;well&#39;</span><span class="p">:</span> <span class="n">adata1</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;summed deviation&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Summed absolute deviations across wells&#39;</span><span class="p">)</span>

<span class="n">plot_deviations</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">gen_adata</span><span class="p">,</span> <span class="s1">&#39;gen. data vs. spacem&#39;</span><span class="p">)</span>
<span class="n">plot_deviations</span><span class="p">(</span><span class="n">gen_adata</span><span class="p">,</span> <span class="n">adata_cor</span><span class="p">,</span> <span class="s1">&#39;corr. data vs. gen. data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/analysis_Lx_Pancreatic_Cancer_pipeline_02_processing_batch_corr_16_0.png" class="no-scaled-link" src="../../_images/analysis_Lx_Pancreatic_Cancer_pipeline_02_processing_batch_corr_16_0.png" style="width: 577px; height: 454px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">src.evaluation</span> <span class="kn">import</span> <span class="n">plot_deviations_between_adatas</span>
<span class="n">plot_deviations_between_adatas</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">gen_adata</span><span class="p">,</span> <span class="n">adata_cor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/mklein/FDA_project/src/evaluation.py:200: FutureWarning: The default value of numeric_only in DataFrameGroupBy.median is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  df_out = pd.concat({&#39;median&#39;: diff_df.reset_index().melt(id_vars=&#34;well&#34;).groupby(&#34;well&#34;).median(),
/home/mklein/FDA_project/src/evaluation.py:201: FutureWarning: The default value of numeric_only in DataFrameGroupBy.quantile is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  &#39;25&#39;: diff_df.reset_index().melt(id_vars=&#34;well&#34;).groupby(&#34;well&#34;).quantile(q=0.25),
/home/mklein/FDA_project/src/evaluation.py:202: FutureWarning: The default value of numeric_only in DataFrameGroupBy.quantile is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  &#39;75&#39;: diff_df.reset_index().melt(id_vars=&#34;well&#34;).groupby(&#34;well&#34;).quantile(q=0.75),
/home/mklein/FDA_project/src/evaluation.py:210: UserWarning: FixedFormatter should only be used together with FixedLocator
  plt.set_xticklabels(plt.get_xticklabels(), rotation=45, horizontalalignment=&#39;right&#39;)
/home/mklein/FDA_project/src/evaluation.py:200: FutureWarning: The default value of numeric_only in DataFrameGroupBy.median is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  df_out = pd.concat({&#39;median&#39;: diff_df.reset_index().melt(id_vars=&#34;well&#34;).groupby(&#34;well&#34;).median(),
/home/mklein/FDA_project/src/evaluation.py:201: FutureWarning: The default value of numeric_only in DataFrameGroupBy.quantile is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  &#39;25&#39;: diff_df.reset_index().melt(id_vars=&#34;well&#34;).groupby(&#34;well&#34;).quantile(q=0.25),
/home/mklein/FDA_project/src/evaluation.py:202: FutureWarning: The default value of numeric_only in DataFrameGroupBy.quantile is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  &#39;75&#39;: diff_df.reset_index().melt(id_vars=&#34;well&#34;).groupby(&#34;well&#34;).quantile(q=0.75),
/home/mklein/FDA_project/src/evaluation.py:210: UserWarning: FixedFormatter should only be used together with FixedLocator
  plt.set_xticklabels(plt.get_xticklabels(), rotation=45, horizontalalignment=&#39;right&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">gen. data vs. spacem</th>
      <th colspan="2" halign="left">corr. data vs. gen. data</th>
    </tr>
    <tr>
      <th></th>
      <th>median</th>
      <th>iqr</th>
      <th>median</th>
      <th>iqr</th>
    </tr>
    <tr>
      <th>well</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>S3_W5</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.376980</td>
      <td>0.372009</td>
    </tr>
    <tr>
      <th>S2_W5</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.294367</td>
      <td>0.341894</td>
    </tr>
    <tr>
      <th>S1_W7</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.135600</td>
      <td>0.318315</td>
    </tr>
    <tr>
      <th>S1_W8</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.177027</td>
      <td>0.292853</td>
    </tr>
    <tr>
      <th>S1_W6</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.311337</td>
      <td>0.346558</td>
    </tr>
    <tr>
      <th>S3_W8</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.234165</td>
      <td>0.313128</td>
    </tr>
    <tr>
      <th>S3_W6</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.370437</td>
      <td>0.338418</td>
    </tr>
    <tr>
      <th>S3_W7</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.160016</td>
      <td>0.340935</td>
    </tr>
    <tr>
      <th>S2_W7</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.151136</td>
      <td>0.358105</td>
    </tr>
    <tr>
      <th>S2_W8</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.209586</td>
      <td>0.312833</td>
    </tr>
    <tr>
      <th>S2_W6</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.387003</td>
      <td>0.327947</td>
    </tr>
    <tr>
      <th>S1_W5</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.295722</td>
      <td>0.335145</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/analysis_Lx_Pancreatic_Cancer_pipeline_02_processing_batch_corr_17_2.png" class="no-scaled-link" src="../../_images/analysis_Lx_Pancreatic_Cancer_pipeline_02_processing_batch_corr_17_2.png" style="width: 590px; height: 483px;" />
</div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/analysis/Lx_Pancreatic_Cancer/pipeline_02_processing_batch_corr.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Ion suppression correction  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lx_Pancreatic_Cancer: Processing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Marius Klein.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>